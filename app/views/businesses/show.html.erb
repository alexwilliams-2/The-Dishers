<div class="container">

  <h2><%= @business.first.name %></h2>

  <%= cl_image_tag @business.first.photo.key, height: 300%> <%# As the show method in business controller was changed to where(id: params[:id]) (AN ARRAY WAS CREATED), we have to use .first or .last to get this business out of the array %>
  <p> <strong> <%= pluralize @business.first.reviews.size, "Review" %> </strong></p>


  <% if @business.first.reviews.blank? %>
    <h3> Be the first to review <%= @business.name %> </h3>

  <% else @business.first.reviews.each do |review| %>
    <div class="review-card m-2 mt-5 col-sm-6">
      <div class="review-card-user-info">
        <h4> <%= review.user.username %> says ... </h4>
        <p> <strong> Position: </strong> <%= review.job_title %> </p>
        <p> <strong> Wage: </strong> <%= number_to_currency(review.wage, unit: "£") %> per hour </p>
      </div>
      <div class="review-card-content">
        <p> <%= "#{("⭐" * review.rating)}" %> </p>
        <p> <%= review.content %> <p>
      </div>
    </div>
    <% end %>
  <% end %>

  <button type="button" class="btn-ghost" data-bs-toggle="modal" data-bs-target="#new_review_modal">
    Add a review
  </button>

  <%= button_to 'Add to Favourites', business_user_favourites_path(@business.first), class: "btn-ghost" %>
  <%# <%= simple_form_for @favourite do |f| %>
  <%#= f.input :business, as: :hidden, input_html: { value:  @business.first.id } %>
  <%#= f.button :submit  %>
  <%# end %>

  <div style="width: 100%; height: 600px;"
    data-controller="map"
    data-map-markers-value="<%= @markers.to_json %>"
    data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
  </div>

</div>

<%= render "modal" %>
