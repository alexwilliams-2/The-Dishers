<div class="banner" style="background-image: linear-gradient(rgba(0,0,0,0.4),rgba(0,0,0,0.4)), url(https://images.unsplash.com/photo-1462539405390-d0bdb635c7d1?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1520&q=80);">
  <div class="container">
    <h1> Welcome to The Dishers </h1>
    <h4> <strong> A community </strong> </h4>
    <p> For hospitality professionals </p>
    <%= link_to 'Find your new business', businesses_path, style: 'text-decoration: none; color: white', class: "btn-flat btn-flat:hover" %>
  </div>
</div>

<div class="container my-5">
    <h3> Don’t waste your time. </h3>
    <h3> Make informed decisions about your next employer
      through our community of dedicated hospitality professionals. </h3>
    <h3> Share your experiences. Learn from others. </h3>
  </div>
</div>

<div class="container">
  <div class="container d-flex justify-content-between mt-3">
    <div class="row col-sm-4 m-4 p-3 mission-card">
      <h4> Bringing transparency to hospitality </h4>
      <p> Too many businesses take advantage of their employees’ hard-work and dedication. By drawing on the personal experience of dedicated professionals, we shine a light on poor practices and celebrate businesses who do things right.  </p>
    </div>
    <div class="row col-sm-4 m-4 p-3 mission-card">
      <h4> Bringing transparency to hospitality </h4>
      <p> Too many businesses take advantage of their employees’ hard-work and dedication. By drawing on the personal experience of dedicated professionals, we shine a light on poor practices and celebrate businesses who do things right.  </p>
    </div>
    <div class="row col-sm-4 m-4 p-3 mission-card">
      <h4> Bringing transparency to hospitality </h4>
      <p> Too many businesses take advantage of their employees’ hard-work and dedication. By drawing on the personal experience of dedicated professionals, we shine a light on poor practices and celebrate businesses who do things right.  </p>
    </div>
  </div>

  <div class="container my-5">
    <h3> Top Rated </h3>
</div>

  <div id="businesses">
    <% if @businesses.any? %>
      <div class="row">
        <% @businesses.sort_by { |business| business.reviews.average(:rating) }.reverse.first(4).each_slice(2) do |businesses_row| %>
          <div class="container d-flex justify-content-between">
            <% businesses_row.each do |business| %>
              <% @wages = [] %>
              <% @recommended_array = [] %>
              <% @ratings = [] %>
              <%= link_to business, style: 'text-decoration: none; color: #000000' do %>
                <div class="business-card mt-5">
                  <%= cl_image_tag business.photo.key, height: 300 %>
                  <div class="business-card-infos">
                    <div class="d-flex justify-content-between">
                      <h2> <%= business.name %> </h2>
                      <% business.reviews.each do |review| %>
                        <% @wages.push(review.wage) %>
                      <% end %>
                      <% unless business.reviews.empty? %>
                        <p> <%= "Average wage: #{number_to_currency((@wages.sum / business.reviews.length), options = {unit: "£"}) }"%> </p>
                      <% end %>
                    </div>
                    <% business.reviews.each do |review| %>
                      <% @ratings.push(review.rating) %>
                    <% end %>
                    <% unless business.reviews.empty? %>
                      <%= "Average rating " "#{pluralize (@ratings.sum / business.reviews.length).ceil, "star"}" %>
                    <% end %>
                    <p> <%= business.description[0..100] %> </p>
                    <% business.reviews.each do |review| %>
                      <% if review.recommended = true %>
                        <% @recommended_array.push(review) %>
                      <% end %>
                    <% end %>
                    <p> <%= "#{pluralize (@recommended_array.length), "Disher"} recommends working here" %> </p>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>
        <% end %>
      </div>
    <% else %>
      <em> Sorry, no businesses found. </em>
    <% end %>
  </div>
</div>
